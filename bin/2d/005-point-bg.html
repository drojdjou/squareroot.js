<!DOCTYPE html>
<html>
<head>
<title>Point Background | v0.58</title>

<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../build/squareroot-min.js"></script>
<!-- SQRLIB -->

<script type="text/javascript" src="../../lib/Stats.js"></script>

<style type="text/css">

    body {
        overflow: hidden;
        background: #ffffff;
        font-family: Arial;
    }

    #cnv {
        background-color: #ffffff;
        position: fixed;
        top: 0px;
        left: 0px;
    }

    #np {
        position: absolute;
        background-color: #ffffff;
    }

</style>

<script type="text/javascript">

    var margin = 0;
    var spacing = 6;

    var cnv, ctx, igd;

    var mx = 0, my = 0;
    var tmx = 0, tmy = 0;

    var strength = 1;
    var bounce = 0;
    var bounceForce = 0;
    var radius = 80 * 80;
    var radiusExt = 0;

    var stats;

    var particles = [];

    window.onload = function() {

        stats = new Stats();
        stats.setMode(0);
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.right = '0px';
        stats.domElement.style.top = '0px';
        document.body.appendChild(stats.domElement);

        cnv = document.getElementById('cnv');
        cnv.width = window.innerWidth;
        cnv.height = window.innerHeight;

        ctx = cnv.getContext('2d');
        igd = ctx.getImageData(0, 0, cnv.width, cnv.height);

        document.addEventListener('mousemove', function(e) {
            tmx = e.pageX;
            tmy = e.pageY;
            e.preventDefault();
        }, false);

        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
            tmx = e.targetTouches[0].pageX;
            tmy = e.targetTouches[0].pageY;
        }, false);

        document.addEventListener('click', function(e) {
            bounceForce = 6;
            radiusExt = 50 * 50;
            bounce = 0;
        }, false);

        document.addEventListener('touchstart', function(e) {
            bounceForce = 1;
            bounce = 0;
        }, false);

        for (var i = margin; i < cnv.width; i += spacing) {
            for (var j = margin; j < cnv.height; j += spacing) {
                var p = {};

                p.ox = i;
                p.oy = j;

                p.x = i;
                p.y = j;

                p.tx = 0;
                p.ty = 0;

                p.push = 0;

                particles.push(p);
            }
        }
        document.getElementById('np').innerHTML = particles.length;


        ctx.globalAlpha = 1;

        draw();
    }

    function draw() {
        requestAnimFrame(draw);

        stats.begin();

        igd = ctx.createImageData(cnv.width, cnv.height);

        var cw = cnv.width;
        var ch = cnv.height;
        var iw = igd.width;

        mx += (tmx - mx) * 0.1;
        my += (tmy - my) * 0.1;

        bounce += 0.2;
        bounceForce *= 0.9;

        var pl = particles.length;

        var r = radius + radiusExt;
        radiusExt *= 0.99;

        for (var i = 0; i < pl; i++) {

            var p = particles[i];

            var di = p.ox - mx;
            var dj = p.oy - my;

            var m = di * di + dj * dj;

//            m = Math.min(m, radius);
//            m = Math.pow(1 - m / radius, 3);
//


            var pu = (1 - m/r);

            if (m < r && p.push < pu) {
                var m = Math.pow(pu, 3);
                var bs = m * (strength + Math.sin(bounce) * bounceForce * 0.5 + bounceForce * 0.5);
                p.tx = di * bs;// * bs;
                p.ty = dj * bs;// * bs;
                p.push = pu;
            }

            p.tx *= 0.98;
            p.ty *= 0.98;
            p.push *= 0.98;

            p.x = p.ox + p.tx;
            p.y = p.oy + p.ty;

            igd.data[( (p.y | 0) * iw + (p.x | 0) ) * 4 + 3] = 255;

        }

        ctx.putImageData(igd, 0, 0);

        stats.end();
    }

</script>

</head>
<body>
<canvas id="cnv"></canvas>
<div id="np"></div>
</body>
</html>