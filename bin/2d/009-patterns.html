<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
    <title> | v0.1</title>

    <style type="text/css">

        body {
            margin: 0;
            border: 0;
            overflow: hidden;
            background-color: #fff;
        }

        canvas {
            background-color: #fff;
        }

    </style>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../src/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/SquarerootGL.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Cube.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Quad.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Sprite2D.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Sprite3D.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Tube.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Mathx.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Noise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/PerlinNoise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/sqr/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spline.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spring.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/sqr/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Point.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/WebGL.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Color.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/GL.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Loader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Shader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

    <script type="text/javascript">

        var cnv, ctx, img, imgData;

        var w, h, s, rf;

        var numNodes = 1200;
        var nodes = [];
        var connections = [];

        var maxWidth = 2;
        var maxDist = 60;

        window.onload = function() {
            w = window.innerWidth;
            h = window.innerHeight;
            s = window.window.innerWidth;
            rf = Math.random;

            img = new Image();
            img.onload = draw;
            img.src = '008-patterns/world.jpg';
        }

        function draw() {
            var ci = document.createElement('canvas');
            ci.width = img.width;
            ci.height = img.height;
            var cx = ci.getContext('2d');
            cx.drawImage(img, 0, 0);

            imgData = cx.getImageData(0, 0, img.width, img.height);

            cnv = document.createElement('canvas');
            cnv.width = s;
            cnv.height = s;
            cnv.style.position = 'absolute';

            document.body.appendChild(cnv);

            ctx = cnv.getContext('2d');

            var pointToFind = numNodes;
            while (pointToFind > 0) {

                var seedX = rf();
                var seedY = rf();
                var v = new SQR.V2(seedX, seedY);

                if (SQR.CanvasUtil.getPixelNormRed(imgData, v.x, v.y) < 128) {
                    v.mass = 1;

                    v.mul(s);
//                  cnv.style.left = (w - h) / 2 + 'px';
                  cnv.style.top = (w - h) / -2 + 'px';
//                    cnv.style.top = -h + 'px';

                    nodes.push(v);
                    pointToFind--;
                }
            }

            for (var i = 0; i < numNodes; i++) {
                for (var j = i + 1; j < numNodes; j++) {
                    var v1 = nodes[i];
                    var v2 = nodes[j];
                    var d = new SQR.V2().sub(v1, v2).mag();

                    if (d < maxDist) {
                        v1.mass += 0.2;
                        v2.mass += 0.2;
                        connections.push([v1, v2, 1]);//d / maxDist * maxWidth]);
                    } else {
                        //?
                    }
                }
            }


            ctx.strokeStyle = 'rgba(0,0,0, 0.02)';

            for (var i = 0; i < numNodes; i++) {
                var v = nodes[i];

//                ctx.fillStyle = 'rgba(0,0,0, 0.1)';
//                ctx.beginPath();
//                ctx.arc(v.x, v.y, v.mass, 0, SQR.twoPI);
//                ctx.fill();

                ctx.fillStyle = 'rgba(0,0,0, 0.1)';
                ctx.beginPath();
                ctx.arc(v.x, v.y, 1, 0, SQR.twoPI);
                ctx.fill();
            }

            for (var i = 0; i < connections.length; i++) {
                var l = connections[i];

                for (var j = 0; j < 1; j++) {
                    ctx.beginPath();
                    ctx.lineWidth = l[2];
                    ctx.moveTo(l[0].x, l[0].y);

//                    var cx = l[0].x + (l[1].x - l[0].x) * rf();
//                    var cy = l[0].y + (l[1].y - l[0].y) * rf();
//                    ctx.quadraticCurveTo(cx, cy, l[1].x, l[1].y);

                    ctx.lineTo(l[1].x, l[1].y);
                    ctx.stroke();
                }
            }
        }

    </script>

</head>
<body>
</body>
</html>