var SQR={TWOPI:2*Math.PI,HALFPI:.5*Math.PI,EPSILON:1e-6,gl:null,flipMatrix:!0,fullScreenQuad:null,shaderPath:".",Primitives:{V2:function(t,r){return new SQR.V2(t,r)},V3:function(t,r,i){return new SQR.V3(t,r,i)},Q:function(t,r,i,n){return new SQR.Quaternion(t,r,i,n)},M4:function(){return new SQR.Matrix44},F:function(t){var r=function(t,i,n,e){var o=SQR.Face().v(t,i,n,e);return r.faces.push(o),o};return r.faces=[],r.toBuffer=function(i){var n=0;return r.faces.forEach(function(r){t&&t.reverseNormals&&r.flip(),r.calculateNormal(),n+=r.toBuffer(i,n,t&&t.perVertexNormal)}),n},r}},v2:function(){return{aPosition:2}},v3:function(){return{aPosition:3}},v2u2:function(){return{aPosition:2,aUV:2}},v2c3:function(){return{aPosition:2,aColor:3}},v3n3:function(){return{aPosition:3,aNormal:3}},v3n3u2:function(){return{aPosition:3,aNormal:3,aUV:2}},WARN_UNIFORM_NOT_PRESENT:!1};SQR.Version={version:"3.0",build:215,date:"Oct 19th 2017"},SQR.Bezier=function(t,r,i,n){var e=this;this.p0=t,this.c0=r,this.c1=i,this.p1=n;var o,a,s,h=SQR.Interpolation.bezierPosition,u=SQR.Interpolation.bezierVelocity;this.velocityAt=function(t,r){return a=a||this.p0.clone().set(),r=r||a,r.x=u(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),r.y=u(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==r.z&&null!==this.p0.z&&(r.z=u(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),r},this.valueAt=function(t,r){return o=o||this.p0.clone().set(),r=r||o,r.x=h(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),r.y=h(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==r.z&&null!==this.p0.z&&(r.z=h(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),r},this.matrixAt=function(t,r){s=s||new SQR.Matrix44,r=r||s,r.identity();var i=e.valueAt(t),n=e.velocityAt(t).norm(),o=SQR.V3.__tv1.set().cross(n,SQR.V3.up),a=SQR.V3.__tv2.set().cross(n,o);return r.data[0]=o.x,r.data[4]=a.x,r.data[8]=n.x,r.data[1]=o.y,r.data[5]=a.y,r.data[9]=n.y,r.data[2]=o.z,r.data[6]=a.z,r.data[10]=n.z,r.setTranslation(i.x,i.y,i.z),r}},SQR.Color=function(t,r,i,n){if(!(this instanceof SQR.Color))return new SQR.Color(t,r,i,n);"string"==typeof t?(this.setHex(t),this.a=void 0==r?1:r):t&&void 0!=t.r?(this.setRGB(t.r,t.g,t.b),void 0!=t.a?this.a=t.a:this.a=void 0!=r?r:1):(this.setRGB(t,r,i),this.a=void 0==n?1:n)},SQR.Color.prototype.setRGB=function(t,r,i){var n=this;return n.r=t||0,n.g=r||0,n.b=i||0,n},SQR.Color.prototype.setHex=function(t){var r=this;return"string"==typeof t&&(t=0==t.indexOf("#")?t.substring(1):t,t=-1==t.indexOf("0x")?"0x"+t:t,t=parseInt(t)),r.r=(t>>16&255)/255,r.g=(t>>8&255)/255,r.b=(255&t)/255,r},SQR.Color.prototype.toCSS=function(){var t=this;return"rgb("+(255*t.r|0)+", "+(255*t.g|0)+", "+(255*t.b|0)+")"},SQR.Color.prototype.copyFrom=function(t){var r=this;return r.r=t.r,r.g=t.g,r.b=t.b,r},SQR.Color.prototype.lighten=function(t){return this.mul(t)},SQR.Color.prototype.clone=function(){return new SQR.Color(c.r,c.g,c.b)},SQR.Color.prototype.mul=function(t){var r=this;return r.r=Math.min(1,r.r*t),r.g=Math.min(1,r.g*t),r.b=Math.min(1,r.b*t),r},SQR.Color.prototype.lerp=function(t,r,i){var n=this,e=1-i;return n.r=t.r*e+r.r*i,n.g=t.g*e+r.g*i,n.b=t.b*e+r.b*i,n},SQR.Color.prototype.toUniform=function(t){var r=t==SQR.gl.FLOAT_VEC4,i=this;return i._array||(i._array=new Float32Array(r?4:3)),i._array[0]=i.r,i._array[1]=i.g,i._array[2]=i.b,r&&(i._array[3]=i.a),i._array},SQR.Delaunay=function(){function t(t,r){var n=[];return r=r.filter(function(r){return!r.vertexInCircumcircle(t)||(n.push(new i(r.v0,r.v1)),n.push(new i(r.v1,r.v2)),n.push(new i(r.v2,r.v0)),!1)}),n=e(n),n.forEach(function(i){r.push(new SQR.Triangle(i.v0,i.v1,t))}),r}var r={},i=function(t,r){this.v0=t,this.v1=r};i.prototype.equals=function(t){return this.v0===t.v0&&this.v1===t.v1},i.prototype.inverse=function(){return new i(this.v1,this.v0)};var n=function(t){var r,i,n,e;t.forEach(function(t){(void 0===r||t.x<r)&&(r=t.x),(void 0===i||t.y<i)&&(i=t.y),(void 0===n||t.x>n)&&(n=t.x),(void 0===e||t.y>e)&&(e=t.y)});var o=10*(n-r),a=10*(e-i),s=t[0].clone().set(r-o,i-3*a),h=t[0].clone().set(r-o,e+a),u=t[0].clone().set(n+3*o,e+a);return new SQR.Triangle(s,h,u)},e=function(t){for(var r=[],i=0;i<t.length;++i){for(var n=t[i],e=!0,o=0;o<t.length;++o)if(i!==o){var a=t[o];if(n.equals(a)||n.inverse().equals(a)){e=!1;break}}e&&r.push(n)}return r};return r.triangulate=function(r){var i=[],e=n(r);return i.push(e),r.forEach(function(r){i=t(r,i)}),i=i.filter(function(t){return!(t.v0==e.v0||t.v0==e.v1||t.v0==e.v2||t.v1==e.v0||t.v1==e.v1||t.v1==e.v2||t.v2==e.v0||t.v2==e.v1||t.v2==e.v2)})},r}(),SQR.Interpolation={bezierPosition:function(t,r,i,n,e){return r*(1-t)*(1-t)*(1-t)+3*i*t*(1-t)*(1-t)+3*n*t*t*(1-t)+e*t*t*t},bezierVelocity:function(t,r,i,n,e){return 3*i-3*r+2*(3*r-6*i+3*n)*t+3*(3*i-r-3*n+e)*t*t},linear:function(t,r,i){return i<=t?t:i>=r?r:(i=(i-t)/(r-t),t+(r-t)*i)},smoothStep:function(t){return 3*t*t-2*t*t*t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},SQR.Intersection={},SQR.Intersection.rayTest=function(t,r){if(!r.collider)return console.log("Intersection test failed. "+r.name+" has no collider."),!1;switch(SQR.Intersection.__tv1||(SQR.Intersection.__tv1=new SQR.V3,SQR.Intersection.__tv2=new SQR.V3,SQR.Intersection.__tv3=new SQR.V3,SQR.Intersection.__tv4=new SQR.V3,SQR.Intersection.__tv5=new SQR.V3,SQR.Intersection.__tv6=new SQR.V3,SQR.Intersection.__tv7=new SQR.V3),r.collider.type){case SQR.Collider.SPHERE:return SQR.Intersection.raySphere(t,r);case SQR.Collider.BOX:return SQR.Intersection.rayBox(t,r);case SQR.Collider.MESH:return SQR.Intersection.rayMesh(t,r);default:throw console.log(r.collider),"> SQR.Intersection > unknown collider type on "+r.name}},SQR.Intersection.rayMesh=function(t,r){if(r.collider.box){if(!SQR.Intersection.rayBox(t,r))return!1}else t.makeLocal(r);for(var i=r.buffer.getDataArray(),n=r.buffer.getIndexArray(),e=r.buffer.attributes.aPosition.offset,o=!1,a=SQR.Intersection.__tv1,s=SQR.Intersection.__tv2,h=SQR.Intersection.__tv3,u=0;u<n.length;u+=3){var c=n[u+0]*r.buffer.strideSize+e,l=n[u+1]*r.buffer.strideSize+e,y=n[u+2]*r.buffer.strideSize+e;if(a.set(i[c],i[c+1],i[c+2]),s.set(i[l],i[l+1],i[l+2]),h.set(i[y],i[y+1],i[y+2]),o=o||SQR.Intersection.rayTriangle(t,a,s,h))break}return o},SQR.Intersection.rayTriangle=function(t,r,i,n,e){var o=SQR.Intersection.__tv4,e=SQR.Intersection.__tv5,a=SQR.Intersection.__tv6,s=SQR.Intersection.__tv7;a.sub(r,i),s.sub(n,r),e.cross(a,s).norm();var h=SQR.V3.dot(e,t.localDirection);if(!(h<0))return!1;var u=SQR.V3.dot(e,r),c=u-SQR.V3.dot(e,t.localOrigin);if(!(c<=0))return!1;c/=h,o.copyFrom(t.localDirection),o=o.norm().mul(c),o.add(t.localOrigin);var l,y,f,v,p,x;Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?(l=o.y-r.y,y=i.y-r.y,f=n.y-r.y,v=o.z-r.z,p=i.z-r.z,x=n.z-r.z):(l=o.x-r.x,y=i.x-r.x,f=n.x-r.x,v=o.y-r.y,p=i.y-r.y,x=n.y-r.y):Math.abs(e.y)>Math.abs(e.z)?(l=o.x-r.x,y=i.x-r.x,f=n.x-r.x,v=o.z-r.z,p=i.z-r.z,x=n.z-r.z):(l=o.x-r.x,y=i.x-r.x,f=n.x-r.x,v=o.y-r.y,p=i.y-r.y,x=n.y-r.y);var S=y*x-p*f;if(0==S)return!1;S=1/S;var d=(l*x-v*f)*S;if(!(d>=0))return!1;var Q=(y*v-p*l)*S;return Q>=0&&(1-d-Q>=0&&c)},SQR.Intersection.raySphere=function(t,r){var i=SQR.Intersection.__tv1,n=r.collider.radius,e=n*n;if(t.makeLocal(r),i.sub(r.collider.center,t.localOrigin),i.lengthSq<e)return!1;var o=SQR.V3.dot(i,t.localDirection);if(o<=0)return!1;var r=e-(i.magsq()-o*o);return r>=0&&Math.abs(o)-Math.sqrt(r)},SQR.Intersection.rayBox=function(t,r){var i=r.collider.box;t.makeLocal(r);var n=0,e=0,o=0,a=!0;if(t.localOrigin.x<i.minX?(n=i.minX-t.localOrigin.x,n/=t.localDirection.x,a=!1,-1):t.localOrigin.x>i.maxX&&(n=i.maxX-t.localOrigin.x,n/=t.localDirection.x,a=!1,1),t.localOrigin.y<i.minY?(e=i.minY-t.localOrigin.y,e/=t.localDirection.y,a=!1,-1):t.localOrigin.y>i.maxY&&(e=i.maxY-t.localOrigin.y,e/=t.localDirection.y,a=!1,1),t.localOrigin.z<i.minZ?(o=i.minZ-t.localOrigin.z,o/=t.localDirection.z,a=!1,-1):t.localOrigin.z>i.maxZ&&(o=i.maxZ-t.localOrigin.z,o/=t.localDirection.z,a=!1,1),a)return-1;var s=0,h=n;switch(e>h&&(s=1,h=e),o>h&&(s=2,h=o),s){case 0:var u=t.localOrigin.y+t.localDirection.y*h;if(u<i.minY||u>i.maxY)return!1;var c=t.localOrigin.z+t.localDirection.z*h;if(c<i.minZ||c>i.maxZ)return!1;break;case 1:var l=t.localOrigin.x+t.localDirection.x*h;if(l<i.minX||l>i.maxX)return!1;var c=t.localOrigin.z+t.localDirection.z*h;if(c<i.minZ||c>i.maxZ)return!1;break;case 2:var l=t.localOrigin.x+t.localDirection.x*h;if(l<i.minX||l>i.maxX)return!1;var u=t.localOrigin.y+t.localDirection.y*h;if(u<i.minY||u>i.maxY)return!1}return h},Math.clamp=function(t,r,i){return t<=r?r:t>=i?i:t},Math.clamp01=function(t){return t<=0?0:t>=1?1:t},Math.absMin=function(t,r){return t<=-r||t>=r?t:t>=0?r:-r},Math.map=function(t,r,i){return t<=r?0:t>=i?1:(t-r)/(i-r)},SQR.Matrix2D=function(){this.data=new Float32Array(9);var t,r,i,n,e;this.identity=function(t){return t=t||this.data,t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t){return i=this.data,n=t.x,e=t.y,t.x=i[0]*n+i[1]*e+i[2],t.y=i[3]*n+i[4]*e+i[5],t},this.setTranslation=function(t,r,n){return i=n||this.data,i[0]=1,i[3]=0,i[6]=t,i[1]=0,i[4]=1,i[7]=r,i[2]=0,i[5]=0,i[8]=1,this},this.getTranslation=function(t){return i=this.data,t=t||new SQR.V2,t.x=i[2],t.y=i[5],t},this.setScale=function(t,r,n){return i=n||this.data,i[0]=t,i[3]=0,i[6]=0,i[1]=0,i[4]=r,i[7]=0,i[2]=0,i[5]=0,i[8]=1,this},this.setShear=function(t,r,n){return i=n||this.data,i[0]=1,i[3]=t,i[6]=0,i[1]=r,i[4]=1,i[7]=0,i[2]=0,i[5]=0,i[8]=1,this},this.setRotation=function(t,r){i=r||this.data;var n=Math.cos(t),e=Math.sin(t);return i[0]=n,i[3]=-e,i[6]=0,i[1]=e,i[4]=n,i[7]=0,i[2]=0,i[5]=0,i[8]=1,this},this.setTRS=function(t,r,n,e,o){i=this.data;var a=Math.cos(n),s=Math.sin(n);return i[0]=a*e,i[3]=-s*o,i[6]=t,i[1]=s*e,i[4]=a*o,i[7]=r,i[2]=0,i[5]=0,i[8]=1,this},this.translate=function(t,r){return this.identity(SQR.Matrix2D.__temp),this.setTranslation(t,r,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.rotate=function(t){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.scale=function(t,r){return this.identity(SQR.Matrix2D.__temp),this.setScale(t,r,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.shear=function(t,r){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,r,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)};var o,a,s,h,u,c,l,y,f,v,p,x,S,d,Q,R,m,z;this.multiply=function(i){return t=this.data,r=i.data||i,o=t[0],a=t[3],s=t[6],h=t[1],u=t[4],c=t[7],l=t[2],y=t[5],f=t[8],v=r[0],p=r[3],x=r[6],S=r[1],d=r[4],Q=r[7],R=r[2],m=r[5],z=r[8],t[0]=o*v+a*S+s*R,t[3]=o*p+a*d+s*m,t[6]=o*x+a*Q+s*z,t[1]=h*v+u*S+c*R,t[4]=h*p+u*d+c*m,t[7]=h*x+u*Q+c*z,this},this.copyTo=function(i){return t=this.data,r=i.data||i,r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],i},this.copyFrom=function(i){return t=i.data||i,r=this.data,r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],this},this.identity()},SQR.Matrix2D.__temp=new Float32Array(9),SQR.Matrix33=function(){this.data=new Float32Array(9),this.identity=function(){var t=this.data;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.copyTo=function(t){for(var r=this.data,i=t.data||t,n=0;n<9;n++)i[n]=r[n];return this},this.copyFrom=function(t){for(var r=this.data,i=t.data||t,n=0;n<9;n++)r[n]=i[n];return this},this.transformVector=function(t,r){var i=this.data,n=t.x,e=t.y,o=t.z;return r=r||t,r.x=i[0]*n+i[3]*e+i[6]*o,r.y=i[1]*n+i[4]*e+i[7]*o,r.z=i[2]*n+i[5]*e+i[8]*o,r},this.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])+t[3]*(t[7]*t[2]-t[1]*t[8])+t[6]*(t[1]*t[5]-t[4]*t[2])},this.inverse=function(t){var r=this.data;t=t||this.data;var i,n=r[0],e=r[1],o=r[2],a=r[3],s=r[4],h=r[5],u=r[6],c=r[7],l=r[8],y=l*s-h*c,f=-l*a+h*u,v=c*a-s*u,r=n*y+e*f+o*v;return r?(i=1/r,t[0]=y*i,t[1]=(-l*e+o*c)*i,t[2]=(h*e-o*s)*i,t[3]=f*i,t[4]=(l*n-o*u)*i,t[5]=(-h*n+o*a)*i,t[6]=v*i,t[7]=(-c*n+e*u)*i,t[8]=(s*n-e*a)*i,t):(console.warn("Attempt to inverse a singular matrix33. ",this.data),t)},this.transpose=function(){var t=this.data,r=t[0],i=t[3],n=t[6],e=t[1],o=t[4],a=t[7],s=t[2],h=t[5],u=t[8];t[0]=r,t[1]=i,t[2]=n,t[3]=e,t[4]=o,t[5]=a,t[6]=s,t[7]=h,t[8]=u}},SQR.Matrix44=function(t){this.data=t||new Float32Array(16),this.identity=function(t){var r=t||this.data;return r[0]=1,r[4]=0,r[8]=0,r[12]=0,r[1]=0,r[5]=1,r[9]=0,r[13]=0,r[2]=0,r[6]=0,r[10]=1,r[14]=0,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this},this.transformVector=function(t,r){var i=this.data,n=t.x,e=t.y,o=t.z,a=t.w;return r=r||t,r.x=i[0]*n+i[4]*e+i[8]*o+i[12]*a,r.y=i[1]*n+i[5]*e+i[9]*o+i[13]*a,r.z=i[2]*n+i[6]*e+i[10]*o+i[14]*a,r},this.rotateVector=function(t,r){var i=this.data,n=t.x,e=t.y,o=t.z;t.w;return r=r||t,r.x=i[0]*n+i[4]*e+i[8]*o,r.y=i[1]*n+i[5]*e+i[9]*o,r.z=i[2]*n+i[6]*e+i[10]*o,r},this.multiply=function(t){var r,i,n,e,o,a,s,h,u,c,l,y,f,v,p,x,S,d,Q,R,m,z,w,g,M,_,V,b,C,I,A,O,P=this.data,D=t.data||t;return r=P[0],i=P[1],n=P[2],e=P[3],o=P[4],a=P[5],s=P[6],h=P[7],u=P[8],c=P[9],l=P[10],y=P[11],f=P[12],v=P[13],p=P[14],x=P[15],S=D[0],d=D[1],Q=D[2],R=D[3],m=D[4],z=D[5],w=D[6],g=D[7],M=D[8],_=D[9],V=D[10],b=D[11],C=D[12],I=D[13],A=D[14],O=D[15],P[0]=r*S+o*d+u*Q+f*R,P[1]=i*S+a*d+c*Q+v*R,P[2]=n*S+s*d+l*Q+p*R,P[3]=e*S+h*d+y*Q+x*R,P[4]=r*m+o*z+u*w+f*g,P[5]=i*m+a*z+c*w+v*g,P[6]=n*m+s*z+l*w+p*g,P[7]=e*m+h*z+y*w+x*g,P[8]=r*M+o*_+u*V+f*b,P[9]=i*M+a*_+c*V+v*b,P[10]=n*M+s*_+l*V+p*b,P[11]=e*M+h*_+y*V+x*b,P[12]=r*C+o*I+u*A+f*O,P[13]=i*C+a*I+c*A+v*O,P[14]=n*C+s*I+l*A+p*O,P[15]=e*C+h*I+y*A+x*O,this},this.setTQS=function(t,r,i,n,e,o,a,s,h,u,c){var l=c||this.data;this.identity(c);var y=e*e,f=o*o,v=a*a;return SQR.flipMatrix?(l[0]=(1-2*f-2*v)*s,l[1]=(2*e*o-2*a*n)*s,l[2]=(2*e*a+2*o*n)*s,l[4]=(2*e*o+2*a*n)*h,l[5]=(1-2*y-2*v)*h,l[6]=(2*o*a-2*e*n)*h,l[8]=(2*e*a-2*o*n)*u,l[9]=(2*o*a+2*e*n)*u,l[10]=(1-2*y-2*f)*u):(l[0]=(1-2*f-2*v)*s,l[4]=(2*e*o-2*a*n)*s,l[8]=(2*e*a+2*o*n)*s,l[1]=(2*e*o+2*a*n)*h,l[5]=(1-2*y-2*v)*h,l[9]=(2*o*a-2*e*n)*h,l[2]=(2*e*a-2*o*n)*u,l[6]=(2*o*a+2*e*n)*u,l[10]=(1-2*y-2*f)*u),l[12]=t,l[13]=r,l[14]=i,c||this},this.setTRS=function(t,r,i,n,e,o,a,s,h,u){var c=u||this.data;this.identity(u);var l=Math.sin(n),y=Math.cos(n),f=Math.sin(e),v=Math.cos(e),p=Math.sin(o),x=Math.cos(o);return SQR.flipMatrix?(c[0]=(v*x+f*l*p)*a,c[1]=(-v*p+f*l*x)*a,c[2]=f*y*a,c[4]=p*y*s,c[5]=x*y*s,c[6]=-l*s,c[8]=(-f*x+v*l*p)*h,c[9]=(p*f+v*l*x)*h,c[10]=v*y*h):(c[0]=(v*x+f*l*p)*a,c[4]=(-v*p+f*l*x)*a,c[8]=f*y*a,c[1]=p*y*s,c[5]=x*y*s,c[9]=-l*s,c[2]=(-f*x+v*l*p)*h,c[6]=(p*f+v*l*x)*h,c[10]=v*y*h),c[12]=t,c[13]=r,c[14]=i,u||this},this.setScale=function(t,r,i,n){var e=n||this.data;return e[0]=t,e[5]=r,e[10]=i,n||this},this.setTranslation=function(t,r,i,n){var e=n||this.data;return e[12]=t,e[13]=r,e[14]=i,n||this},this.setRotation=function(t,r,i,n){var e=n||this.data,o=Math.sin(t),a=Math.cos(t),s=Math.sin(r),h=Math.cos(r),u=Math.sin(i),c=Math.cos(i);return e[0]=h*c+s*o*u,e[1]=-h*u+s*o*c,e[2]=s*a,e[4]=u*a,e[5]=c*a,e[6]=-o,e[8]=-s*c+h*o*u,e[9]=u*s+h*o*c,e[10]=h*a,n||this},this.translate=function(t,r,i){return this.identity(SQR.Matrix44.__temp),this.setTranslation(t,r,i,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.rotate=function(t,r,i){return this.identity(SQR.Matrix44.__temp),this.setRotation(t,r,i,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.scale=function(t,r,i){return this.identity(SQR.Matrix44.__temp),this.setScale(t,r,i,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.copyTo=function(t){for(var r=this.data,i=t.data||t,n=0;n<16;n++)i[n]=r[n];return this},this.copyFrom=function(t){for(var r=this.data,i=t.data||t,n=0;n<16;n++)r[n]=i[n];return this},this.copyRotationTo=function(t){var r=this.data,i=t.data||t;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],t},this.extractPosition=function(t){var r=this.data;return t.set(r[12],r[13],r[14]),t},this.determinant=function(){var t=this.data;return t[0]*(t[5]*t[10]-t[9]*t[6])+t[4]*(t[9]*t[2]-t[1]*t[10])+t[8]*(t[1]*t[6]-t[5]*t[2])},this.inverse=function(t){var r=this.data,i=t?t.data||t:this.data,n=r[0],e=r[1],o=r[2],a=r[3],s=r[4],h=r[5],u=r[6],c=r[7],l=r[8],y=r[9],f=r[10],v=r[11],p=r[12],x=r[13],S=r[14],d=r[15],Q=n*h-e*s,R=n*u-o*s,m=n*c-a*s,z=e*u-o*h,w=e*c-a*h,g=o*c-a*u,M=l*x-y*p,_=l*S-f*p,V=l*d-v*p,b=y*S-f*x,C=y*d-v*x,I=f*d-v*S,A=Q*I-R*C+m*b+z*V-w*_+g*M;return A?(A=1/A,i[0]=(h*I-u*C+c*b)*A,i[1]=(o*C-e*I-a*b)*A,i[2]=(x*g-S*w+d*z)*A,i[3]=(f*w-y*g-v*z)*A,i[4]=(u*V-s*I-c*_)*A,i[5]=(n*I-o*V+a*_)*A,i[6]=(S*m-p*g-d*R)*A,i[7]=(l*g-f*m+v*R)*A,i[8]=(s*C-h*V+c*M)*A,i[9]=(e*V-n*C-a*M)*A,i[10]=(p*w-x*m+d*Q)*A,i[11]=(y*m-l*w-v*Q)*A,i[12]=(h*_-s*b-u*M)*A,i[13]=(n*b-e*_+o*M)*A,i[14]=(x*R-p*z-S*Q)*A,i[15]=(l*z-y*R+f*Q)*A,t):null},this.inverseMat3=function(t){var r=this.data,i=t.data,n=this.determinant();if(Math.abs(n)<1e-4)return console.warn("> SQR.Matrix44 - Attempt to inverse a singular matrix44. ",this.data),console.trace(),t;var e=r[0],o=r[4],a=r[8],s=(r[12],r[1]),h=r[5],u=r[9],c=(r[13],r[2]),l=r[6],y=r[10];r[14];return n=1/n,i[0]=(h*y-u*l)*n,i[1]=(a*l-o*y)*n,i[2]=(o*u-a*h)*n,i[3]=(u*c-s*y)*n,i[4]=(e*y-a*c)*n,i[5]=(a*s-e*u)*n,i[6]=(s*l-h*c)*n,i[7]=(o*c-e*l)*n,i[8]=(e*h-o*s)*n,t},this.transpose=function(t){var r=this.data,i=t?t.data||t:this.data,n=r[0],e=r[4],o=r[8],a=r[1],s=r[5],h=r[9],u=r[2],c=r[6],l=r[10];i[0]=n,i[1]=e,i[2]=o,i[4]=a,i[5]=s,i[6]=h,i[8]=u,i[9]=c,i[10]=l},this.lookAt=function(t,r){var i=this.data,n=SQR.V3.__tv1,e=SQR.V3.__tv2,o=SQR.V3.__tv3;return r=r||SQR.V3.up,o.set(i[12],i[13],i[14]),o.sub(o,t).norm(),0===o.magsq()&&(o.z=1),n.cross(r,o).norm(),0===n.magsq()&&(o.x+=1e-4,n.cross(r,o).norm()),e.cross(o,n),i[0]=n.x,i[4]=e.x,i[8]=o.x,i[1]=n.y,i[5]=e.y,i[9]=o.y,i[2]=n.z,i[6]=e.z,i[10]=o.z,this},t||this.identity()},SQR.Matrix44.__temp=new Float32Array(16),SQR.PerlinNoise=function(){function t(t,r,i){this.x=t,this.y=r,this.z=i}function r(t){return t*t*t*(t*(6*t-15)+10)}function i(t,r,i){return(1-i)*t+i*r}var n={};t.prototype.dot2=function(t,r){return this.x*t+this.y*r},t.prototype.dot3=function(t,r,i){return this.x*t+this.y*r+this.z*i};var e=[new t(1,1,0),new t(-1,1,0),new t(1,-1,0),new t(-1,-1,0),new t(1,0,1),new t(-1,0,1),new t(1,0,-1),new t(-1,0,-1),new t(0,1,1),new t(0,-1,1),new t(0,1,-1),new t(0,-1,-1)],o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],a=new Array(512),s=new Array(512);n.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var r=0;r<256;r++){var i;i=1&r?o[r]^255&t:o[r]^t>>8&255,a[r]=a[r+256]=i,s[r]=s[r+256]=e[i%12]}},n.seed(0);var h=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6,c=1/6;return n.simplex2=function(t,r){var i,n,e,o,c,l=(t+r)*h,y=Math.floor(t+l),f=Math.floor(r+l),v=(y+f)*u,p=t-y+v,x=r-f+v;p>x?(o=1,c=0):(o=0,c=1);var S=p-o+u,d=x-c+u,Q=p-1+2*u,R=x-1+2*u;y&=255,f&=255;var m=s[y+a[f]],z=s[y+o+a[f+c]],w=s[y+1+a[f+1]],g=.5-p*p-x*x;g<0?i=0:(g*=g,i=g*g*m.dot2(p,x));var M=.5-S*S-d*d;M<0?n=0:(M*=M,n=M*M*z.dot2(S,d));var _=.5-Q*Q-R*R;return _<0?e=0:(_*=_,e=_*_*w.dot2(Q,R)),70*(i+n+e)},n.simplex3=function(t,r,i){var n,e,o,h,u,l,y,f,v,p,x=(t+r+i)*(1/3),S=Math.floor(t+x),d=Math.floor(r+x),Q=Math.floor(i+x),R=(S+d+Q)*c,m=t-S+R,z=r-d+R,w=i-Q+R;m>=z?z>=w?(u=1,l=0,y=0,f=1,v=1,p=0):m>=w?(u=1,l=0,y=0,f=1,v=0,p=1):(u=0,l=0,y=1,f=1,v=0,p=1):z<w?(u=0,l=0,y=1,f=0,v=1,p=1):m<w?(u=0,l=1,y=0,f=0,v=1,p=1):(u=0,l=1,y=0,f=1,v=1,p=0);var g=m-u+c,M=z-l+c,_=w-y+c,V=m-f+2*c,b=z-v+2*c,C=w-p+2*c,I=m-1+.5,A=z-1+.5,O=w-1+.5;S&=255,d&=255,Q&=255;var P=s[S+a[d+a[Q]]],D=s[S+u+a[d+l+a[Q+y]]],T=s[S+f+a[d+v+a[Q+p]]],q=s[S+1+a[d+1+a[Q+1]]],F=.6-m*m-z*z-w*w;F<0?n=0:(F*=F,n=F*F*P.dot3(m,z,w));var E=.6-g*g-M*M-_*_;E<0?e=0:(E*=E,e=E*E*D.dot3(g,M,_));var N=.6-V*V-b*b-C*C;N<0?o=0:(N*=N,o=N*N*T.dot3(V,b,C));var j=.6-I*I-A*A-O*O;return j<0?h=0:(j*=j,h=j*j*q.dot3(I,A,O)),32*(n+e+o+h)},n.perlin2=function(t,n){var e=Math.floor(t),o=Math.floor(n);t-=e,n-=o,e&=255,o&=255;var h=s[e+a[o]].dot2(t,n),u=s[e+a[o+1]].dot2(t,n-1),c=s[e+1+a[o]].dot2(t-1,n),l=s[e+1+a[o+1]].dot2(t-1,n-1),y=r(t);return i(i(h,c,y),i(u,l,y),r(n))},n.perlin3=function(t,n,e){var o=Math.floor(t),h=Math.floor(n),u=Math.floor(e);t-=o,n-=h,e-=u,o&=255,h&=255,u&=255;var c=s[o+a[h+a[u]]].dot3(t,n,e),l=s[o+a[h+a[u+1]]].dot3(t,n,e-1),y=s[o+a[h+1+a[u]]].dot3(t,n-1,e),f=s[o+a[h+1+a[u+1]]].dot3(t,n-1,e-1),v=s[o+1+a[h+a[u]]].dot3(t-1,n,e),p=s[o+1+a[h+a[u+1]]].dot3(t-1,n,e-1),x=s[o+1+a[h+1+a[u]]].dot3(t-1,n-1,e),S=s[o+1+a[h+1+a[u+1]]].dot3(t-1,n-1,e-1),d=r(t),Q=r(n),R=r(e);return i(i(i(c,v,d),i(l,p,d),R),i(i(y,x,d),i(f,S,d),R),Q)},n}(),SQR.ProjectionMatrix=function(){"undefined"==typeof Float32Array&&(Float32Array=Array),this.data=new Float32Array(16),this.copyTo=function(t){for(var r=this.data,i=t.data||t,n=0;n<16;n++)i[n]=r[n];return t},this.identity()},SQR.ProjectionMatrix.getBoundsAtDistance=function(t,r,i,n){i=i||window.innerWidth,n=n||window.innerHeight;var e=i/n,o=Math.tan(t/180*Math.PI/2),a=r*o;return{w:a*e,h:a}},SQR.ProjectionMatrix.prototype.identity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},SQR.ProjectionMatrix.prototype.screenPixels2d=function(){return this.orthographic(window.innerWidth,0,window.innerHeight,0,-1,1e3),this},SQR.ProjectionMatrix.prototype.orthographic=function(t,r,i,n,e,o){var a=this.data;this.near=e,this.far=o;var s=r-t,h=i-n,u=o-e,c=(r+t)/s,l=(i+n)/h,y=(o+e)/u;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-y,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},SQR.ProjectionMatrix.prototype.perspective=function(t,r,i,n){t=t||60,i=i||1,n=n||1e3;var e=this.data,o=i*Math.tan(t*Math.PI/360),a=n-i;return e[0]=i/(o*r),e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=i/o,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=-(n+i)/a,e[14]=-2*n*i/a,e[3]=0,e[7]=0,e[11]=-1,e[15]=0,this.fov=t,this.near=i,this.far=n,this},SQR.ProjectionMatrix.prototype.transformVector=function(t,r){var i=t.x,n=t.y,e=t.z,o=t.w,a=this.data;return r=r||t,r.x=a[0]*i+a[4]*n+a[8]*e+a[12]*o,r.y=a[1]*i+a[5]*n+a[9]*e+a[13]*o,r.z=a[2]*i+a[6]*n+a[10]*e+a[14]*o,r},SQR.Quaternion=function(t,r,i,n){this.set(n,t,r,i)},SQR.Quaternion.prototype.set=function(t,r,i,n){return this.w=n||1,this.x=t||0,this.y=r||0,this.z=i||0,this},SQR.Quaternion.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,this},SQR.Quaternion.prototype.copyFrom=function(t){return t instanceof Array?(this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3]):(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w),this},SQR.Quaternion.prototype.identity=function(){return this.set(),this},SQR.Quaternion.prototype.mul=function(t,r){r=r||this;var i=r.w*t.w-r.x*t.x-r.y*t.y-r.z*t.z,n=r.w*t.x+r.x*t.w+r.y*t.z-r.z*t.y,e=r.w*t.y-r.x*t.z+r.y*t.w+r.z*t.x,o=r.w*t.z+r.x*t.y-r.y*t.x+r.z*t.w;return r.set(n,e,o,i),r.normalize(),r},SQR.Quaternion.prototype.dot=function(t){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},SQR.Quaternion.prototype.lookAt=function(t,r){var i=SQR.Quaternion.__tv1,n=SQR.Quaternion.__tv2,e=SQR.Quaternion.__tv3;t.copyTo(i),r.copyTo(e),i.norm(),-1==i.z&&(i.x=1e-4,i.norm()),n.cross(e,i),e.cross(i,n),this.w=.5*Math.sqrt(1+n.x+e.y+i.z);var o=4*this.w;return this.x=(i.y-e.z)/o,this.y=(n.z-i.x)/o,this.z=(e.x-n.y)/o,this.normalize(),this},SQR.Quaternion.prototype.fromAngleAxis=function(t,r,i,n){var e=Math.sin(t/2);return this.x=r*e,this.y=i*e,this.z=n*e,this.w=Math.cos(t/2),this},SQR.Quaternion.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},SQR.Quaternion.prototype.normalize=function(){var t=this.mag();return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},SQR.Quaternion.prototype.neg=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},SQR.Quaternion.prototype.toMatrix=function(t){throw"SQR.Quaternion.toMatrix() is not implemented. Check SQR.Matrix44.TQS()"},SQR.Quaternion.slerp=function(t,r,i,n){if(n=n||new SQR.Quaternion,0===i)return n.copyFrom(t);if(1===i)return n.copyFrom(r);var e=SQR.Quaternion.dot(t,r);e<0&&(t.neg(),e=SQR.Quaternion.dot(t,r));var o=Math.acos(e),a=Math.sqrt(1-e*e),s=Math.sin((1-i)*o)/a,h=Math.sin(i*o)/a;return Math.abs(e)>=1?(s=1,h=0):Math.abs(a)<.001&&(s=.5,h=.5),n.w=t.w*s+r.w*h,n.x=t.x*s+r.x*h,n.y=t.y*s+r.y*h,n.z=t.z*s+r.z*h,n},SQR.Quaternion.dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z+t.w*r.w},SQR.Quaternion.prototype.slerp=function(t,r,i){return SQR.Quaternion.slerp(t,r,i,this),this},SQR.Quaternion.__tv1=new SQR.Quaternion,SQR.Quaternion.__tv2=new SQR.Quaternion,SQR.Quaternion.__tv3=new SQR.Quaternion,function(t,r){function i(i,u,c){var S=[];u=1==u?{entropy:!0}:u||{};var d=a(o(u.entropy?[i,h(t)]:null==i?s():i,3),S),Q=new n(S),R=function(){for(var t=Q.g(y),r=v,i=0;t<p;)t=(t+i)*l,r*=l,i=Q.g(1);for(;t>=x;)t/=2,r/=2,i>>>=1;return(t+i)/r};return R.int32=function(){return 0|Q.g(4)},R.quick=function(){return Q.g(4)/4294967296},R.double=R,a(h(Q.S),t),(u.pass||c||function(t,i,n,o){return o&&(o.S&&e(o,Q),t.state=function(){return e(Q,{})}),n?(r[f]=t,i):t})(R,d,"global"in u?u.global:this==r,u.state)}function n(t){var r,i=t.length,n=this,e=0,o=n.i=n.j=0,a=n.S=[];for(i||(t=[i++]);e<l;)a[e]=e++;for(e=0;e<l;e++)a[e]=a[o=S&o+t[e%i]+(r=a[e])],a[o]=r;(n.g=function(t){for(var r,i=0,e=n.i,o=n.j,a=n.S;t--;)r=a[e=S&e+1],i=i*l+a[S&(a[e]=a[o=S&o+r])+(a[o]=r)];return n.i=e,n.j=o,i})(l)}function e(t,r){return r.i=t.i,r.j=t.j,r.S=t.S.slice(),r}function o(t,r){var i,n=[],e=typeof t;if(r&&"object"==e)for(i in t)try{n.push(o(t[i],r-1))}catch(t){}return n.length?n:"string"==e?t:t+"\0"}function a(t,r){for(var i,n=t+"",e=0;e<n.length;)r[S&e]=S&(i^=19*r[S&e])+n.charCodeAt(e++);return h(r)}function s(){try{if(u)return h(u.randomBytes(l));var r=new Uint8Array(l);return(c.crypto||c.msCrypto).getRandomValues(r),h(r)}catch(r){var i=c.navigator,n=i&&i.plugins;return[+new Date,c,n,c.screen,h(t)]}}function h(t){return String.fromCharCode.apply(0,t)}var u,c=this,l=256,y=6,f="random",v=r.pow(l,y),p=r.pow(2,52),x=2*p,S=l-1;if(r["seed"+f]=i,a(r.random(),t),"object"==typeof module&&module.exports){module.exports=i;try{u=require("crypto")}catch(t){}}else"function"==typeof define&&define.amd&&define(function(){return i})}([],Math),SQR.Spline=function(){var t,r,i=[],n=[],e=[],o={},a=function(i,n,e,o,a,s){var h=t.sub(i,n).neg(),u=r.sub(i,e),c=s>1?s:s*Math.min(h.mag(),u.mag());o.set().add(h,u).norm().mul(c),a.copyFrom(o).neg(),o.add(o,i),a.add(a,i)};return o.addSegment=function(i){var a;if(void 0!==i.x)a=i;else{var s=arguments,h=s.length;2==h?a=new SQR.V2(s[0],s[1]):3==h&&(a=new SQR.V3(s[0],s[1],s[2]))}return n.push(a),e.push(a.clone(),a.clone()),t||(t=n[0].clone(),r=n[0].clone()),o},o.create=function(t,r){if(n.length<2)return n;t=null!==t?t:.5,i.length=0;for(var s=n,h=e,u=n.length,c=0;c<u;c++){var l=s[c],y=h[2*c].set(),f=h[2*c+1].set(),v=0==c?s[u-1]:s[c-1],p=c==u-1?s[0]:s[c+1];a(l,v,p,y,f,t),h.push(y,f)}for(var c=0;c<u-1;c++){var v=s[c],p=c==u-1?s[0]:s[c+1],y=0!=c||r?h[2*c+1]:v,f=c!=u-2||r?h[2*c+2]:p,x=new SQR.Bezier(v,y,f,p);i.push(x)}if(r){var x=new SQR.Bezier(s[u-1],h[2*(u-1)+1],h[0],s[0]);i.push(x)}return o.smoothness=t,o.close=o.close,o},o.valueAt=function(t,r){1==t&&(t=.999999),t%=1;var n=t*i.length;return i[0|n].valueAt(n%1,r)},o.bezierAt=function(t){1==t&&(t=.999999),t%=1;var r=t*i.length;return i[0|r]},o.velocityAt=function(t,r){1==t&&(t=.999999),t%=1;var n=t*i.length;return i[0|n].velocityAt(n%1,r)},o.matrixAt=function(t,r){0==t&&(t=SQR.EPSILON),1==t&&(t=1-SQR.EPSILON),t%=1;var n=t*i.length;return i[0|n].matrixAt(n%1,r)},Object.defineProperty(o,"segments",{get:function(){return n}}),Object.defineProperty(o,"paths",{get:function(){return i}}),o},SQR.Triangle=function(t,r,i){this.v0=t,this.v1=r,this.v2=i,this.calculateCentroid=function(){this.centroid=new SQR.V2,this.centroid.x=(this.v0.x+this.v1.x+this.v2.x)/3,this.centroid.y=(this.v0.y+this.v1.y+this.v2.y)/3},this.calculateCircumCircle=function(){var t,r,i=this.v1.x-this.v0.x,n=this.v1.y-this.v0.y,e=this.v2.x-this.v0.x,o=this.v2.y-this.v0.y,a=i*(this.v0.x+this.v1.x)+n*(this.v0.y+this.v1.y),s=e*(this.v0.x+this.v2.x)+o*(this.v0.y+this.v2.y),h=2*(i*(this.v2.y-this.v1.y)-n*(this.v2.x-this.v1.x));if(Math.abs(h)<SQR.EPSILON){var u=Math.min(this.v0.x,this.v1.x,this.v2.x),c=Math.min(this.v0.y,this.v1.y,this.v2.y),l=Math.max(this.v0.x,this.v1.x,this.v2.x),y=Math.max(this.v0.y,this.v1.y,this.v2.y);this.circumCenter=new SQR.V2((u+l)/2,(c+y)/2),t=this.circumCenter.x-u,r=this.circumCenter.y-c}else{var f=(o*a-n*s)/h,v=(i*s-e*a)/h;this.circumCenter=new SQR.V2(f,v),t=this.circumCenter.x-this.v0.x,r=this.circumCenter.y-this.v0.y}this.circumRadiusSq=t*t+r*r,this.circumRadius=Math.sqrt(this.circumRadiusSq)},this.vertexInCircumcircle=function(t){this.circumCenter||this.calculateCircumCircle();var r=this.circumCenter.x-t.x,i=this.circumCenter.y-t.y;return r*r+i*i<=this.circumRadiusSq},this.get=function(t){return 0==t?this.v0:1==t?this.v1:2==t?this.v2:void 0}},SQR.V2=function(t,r){this.set(t,r),this.size=2},SQR.V2.prototype.set=function(t,r){return this.x=t||0,this.y=r||0,this},SQR.V2.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},SQR.V2.prototype.copyFrom=function(t){return t instanceof Array?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this},SQR.V2.prototype.clone=function(){return new SQR.V2(this.x,this.y)},SQR.V2.prototype.magsq=function(){return this.x*this.x+this.y*this.y},SQR.V2.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V2.prototype.isZero=function(){return 0==this.x&&0==this.y},SQR.V2.prototype.mul=function(t){return this.x*=t,this.y*=t,this},SQR.V2.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},SQR.V2.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t),this},SQR.V2.prototype.add=function(t,r){return r=r||this,this.x=t.x+r.x,this.y=t.y+r.y,this},SQR.V2.prototype.sub=function(t,r){return r=r||this,this.x=t.x-r.x,this.y=t.y-r.y,this},SQR.V2.prototype.lerp=function(t,r,i){return this.x=t.x+(r.x-t.x)*i,this.y=t.y+(r.y-t.y)*i,this},SQR.V2.dot=function(t,r){return t.x*r.x+t.y*r.y},SQR.V2.prototype.perp=function(){return this.set(this.y,-this.x),this},SQR.V2.prototype.toUniform=function(){return this.toArray()},SQR.V2.prototype.toArray=function(){return this.array||(this.array=new Float32Array(2)),this.array[0]=this.x,this.array[1]=this.y,this.array},SQR.V3=function(t,r,i){this.set(t,r,i),this.size=3,SQR.V3.instances++},SQR.V3.prototype.set=function(t,r,i,n){return this.x=t||0,this.y=r||0,this.z=i||0,this.w=n||1,this},SQR.V3.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,void 0!=t.z&&(t.z=this.z),t},SQR.V3.prototype.copyFrom=function(t){return t instanceof Array?(this.x=t[0],this.y=t[1],this.z=t[2]||0):(this.x=t.x,this.y=t.y,this.z=t.z||0),this},SQR.V3.prototype.clone=function(){return new SQR.V3(this.x,this.y,this.z)},SQR.V3.prototype.magsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},SQR.V3.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V3.prototype.isZero=function(){return Math.abs(this.x)<SQR.EPSILON&&Math.abs(this.y)<SQR.EPSILON&&Math.abs(this.z)<SQR.EPSILON},SQR.V3.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},
SQR.V3.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},SQR.V3.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t,this.z*t),this},SQR.V3.prototype.add=function(t,r){return r=r||this,this.x=t.x+r.x,this.y=t.y+r.y,this.z=t.z+r.z,this},SQR.V3.prototype.sub=function(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this},SQR.V3.prototype.lerp=function(t,r,i){return this.x=t.x+(r.x-t.x)*i,this.y=t.y+(r.y-t.y)*i,this.z=t.z+(r.z-t.z)*i,this},SQR.V3.prototype.random=function(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this.z=2*Math.random()-1,this},SQR.V3.dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z},SQR.V3.prototype.cross=function(t,r){var i=t.y*r.z-t.z*r.y,n=t.z*r.x-t.x*r.z,e=t.x*r.y-t.y*r.x;return this.set(i,n,e,this.w),this},SQR.V3.prototype.toUniform=function(){return this.toArray()},SQR.V3.prototype.toArray=function(){return this.array||(this.array=new Float32Array(3)),this.array[0]=this.x,this.array[1]=this.y,this.array[2]=this.z,this.array},SQR.V3.prototype.toString=function(){return x},SQR.V3.prototype.toScreenSpace=function(t,r){t=t||window.innerWidth,r=r||window.innerHeight,this.x=this.x/this.z*t/2+t/2,this.y=this.y/this.z*r/2+r/2,this.y=r-this.y},SQR.V3.prototype.addNormal=function(t){this.normal||(this.normal=new SQR.V3),this.normal.add(this.normal,t)},SQR.V3.prototype.resetNormal=function(t){this.normal&&this.normal.set()},SQR.V3.up=new SQR.V3(0,1,0),SQR.V3.forward=new SQR.V3(0,0,1),SQR.V3.__tv1=new SQR.V3,SQR.V3.__tv2=new SQR.V3,SQR.V3.__tv3=new SQR.V3,SQR.V3.instances=0,SQR.CanvasRenderer=function(t){var r={},i=null;if(t||(t=document.createElement("canvas")),t instanceof HTMLElement||(t=document.querySelector(t)),!t.getContext)throw"> SQR.Context - Invalid canvas reference.";var n=t.getContext("2d");return n.setLineDash||(n.setLineDash=function(){}),r.canvas=t,r.context=n,r.setSize=function(r,i,n){return n=n||1,t.width=r*n,t.height=i*n,t.style.width=r+"px",t.style.height=i+"px",n},r.setClearColor=function(t){return i=t,r},r.render=function(r){i?(i.indexOf("rgba")>-1&&n.clearRect(0,0,t.width,t.height),n.fillStyle=i,n.fillRect(0,0,t.width,t.height)):n.clearRect(0,0,t.width,t.height),r&&r.draw(n)},r},SQR.Transform2d=function(t){var r={};return r.name=t||"sqr.transform."+SQR.Transform2dCount++,r.position=new SQR.V3(0,0,0),r.rotation=0,r.scale=new SQR.V2(1,1),r.alpha=1,r.children=[],r.numChildren=0,r.add=function(){for(var t=0;t<arguments.length;t++){var i=arguments[t];i.parent=r,-1==r.children.indexOf(i)&&r.children.push(i)}return r.numChildren=r.children.length,r},r.remove=function(){for(var t=0;t<arguments.length;t++){var i=arguments[t],n=r.children.indexOf(i);if(-1==n)return!1;i.parent=null,r.children.splice(n,1)}return r.numChildren=r.children.length,r},r.removeAll=function(){r.children.length=0,r.numChildren=0},r.contains=function(t){return r.children.indexOf(t)>-1},r.recurse=function(t,i){i||t(r);for(var n=0;n<r.numChildren;n++)r.children[n].recurse(t)},r.draw=function(t){var i=t;i.save(),i.translate(r.position.x,r.position.y),i.rotate(r.rotation),i.scale(r.scale.x,r.scale.y);for(var n=0;n<r.numChildren;n++)r.children[n].draw(i);r.alpha<1&&(i.globalAlpha=r.alpha),r.shape&&r.shape(i,r),i.restore()},r},SQR.Transform2dCount=0;