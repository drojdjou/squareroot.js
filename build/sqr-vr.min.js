<<<<<<< HEAD
html,src,vr,Gyro.js,html,src,vr,VRApp.js,html,src,vr,VRPost.js;
=======
SQR.Gyro=function(){var e,t={x:0,y:0,z:0,w:1},n={},r=!1,o=!1,i=0,a=0,s=0;n.getOrientation=function(e){return o||e||y(),t},n.hasGyro=function(){return r},n.isSlow=function(){return o&&(a<3||n.delta()>60)},n.delta=function(){return 0==a?0:parseInt(s/a)},n.externalProcess=function(e,t,n,r){w(e,t,n,r)};var c=null;n.getOffset=function(){return c||0},n.resetOffset=function(){c=null};var u=function(){var e=t,n=2*(e.x*e.z+e.w*e.y),r=1-2*(e.x*e.x+e.y*e.y);return Math.atan2(r,n)},d=function(e,t,n){var r=-t,o=-e;z=n;var i=Math.cos(r/2),a=Math.cos(o/2),s=Math.cos(z/2),c=Math.sin(r/2),u=Math.sin(o/2),d=Math.sin(z/2),l=i*a*s-c*u*d;return r=c*a*s-i*u*d,o=i*u*s+c*a*d,z=i*a*d+c*u*s,{x:r,y:o,z:z,w:l}},l=function(e,t){return{w:e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,x:e.w*t.x+e.x*t.w+e.y*t.z-e.z*t.y,y:e.w*t.y-e.x*t.z+e.y*t.w+e.z*t.x,z:e.w*t.z+e.x*t.y-e.y*t.x+e.z*t.w}},v=.5*Math.PI,m={x:Math.sin(.5*v),y:0,z:0,w:Math.cos(.5*v)},f=function(e){w(e.alpha,e.beta,e.gamma,window.orientation)},w=function(n,o,v,f){if(e&&(i=(new Date).getTime()-e,a++,s+=i),e=(new Date).getTime(),null!=n&&null!=window.orientation){r=!0;var w=d(n/180*Math.PI,o/180*Math.PI,v/180*Math.PI),y=window.orientation/180*Math.PI,h={x:0,y:0,z:Math.sin(.5*y),w:Math.cos(.5*y)};t=w,t=l(m,t),t=l(h,t),null==c&&a>2&&(c=u())}},y=function(){window.addEventListener("deviceorientation",f,!0),o=!0};return n}(),SQR.VRApp=function(e,t){t=t||{},t.isTouch="ontouchstart"in document,t.vrInput=null,t.vrData={};var n,r,o,i={},a="<span>Put on your headset and press space when ready.</span>",s=function(e){e.requestFullscreen?e.requestFullscreen(i):e.msRequestFullscreen?e.msRequestFullscreen(i):e.mozRequestFullScreen?e.mozRequestFullScreen(i):e.webkitRequestFullscreen&&e.webkitRequestFullscreen(i)},c=function(e){32==e.keyCode&&(document.removeEventListener("keydown",c),u())},u=function(i){n&&document.body.removeChild(n),r&&document.body.removeChild(r),o&&document.body.removeChild(o),(t.isTouch||t.vrInput&&!t.debug)&&s(document.body),e&&e(t)},d=function(){t.vrInput&&!t.isTouch?(o=document.createElement("div"),o.innerHTML=a+a,o.setAttribute("class","instr"),document.body.appendChild(o),document.addEventListener("keydown",c)):t.isTouch?(n=document.createElement("div"),n.setAttribute("class","start vr"),n.innerHTML="CARDBOARD",document.body.appendChild(n),r=document.createElement("div"),r.setAttribute("class","start novr"),r.innerHTML="NO CARDBOARD",document.body.appendChild(r),portWarn=document.createElement("div"),portWarn.setAttribute("class","portrait-warning"),portWarn.innerHTML="Please rotate your screen to landscape mode",document.body.appendChild(portWarn),n.addEventListener("click",function(){t.forceStereo=!0,u()}),r.addEventListener("click",function(){t.forceMono=!0,u()})):u()};!function(e){var n,r=function(t){console.log("VR: Error in navigator.getVRDevices()"),console.log(t),e()},o=function(r){SQR.flipMatrix=!1;for(var o=0;o<r.length;o++){var a=r[o];!t.vrInput&&a instanceof PositionSensorVRDevice&&(t.vrInput=a),!n&&a instanceof HMDVRDevice&&(n=a),i.vrDisplay=n}t.vrData.leftEyeX=n.getEyeParameters("left").eyeTranslation.x,t.vrData.rightEyeX=n.getEyeParameters("right").eyeTranslation.x,t.vrData.leftEyeFOV=n.getEyeParameters("left").recommendedFieldOfView,t.vrData.rightEyeFOV=n.getEyeParameters("right").recommendedFieldOfView,e()};if(!navigator.mozGetVRDevices&&!navigator.getVRDevices)return console.log("VR: Your browser is not VR Ready"),void e();navigator.getVRDevices?navigator.getVRDevices().then(o,r):navigator.mozGetVRDevices(o)}(d)},SQR.VRPost=function(e,t,n,r){var o,i,a,s,c,u=r.vrInput&&!r.forceMono||r.forceStereo,d=!0,l=new SQR.Transform,v=new SQR.Transform;return l.position.x=r.vrData.leftEyeX||-.1,v.position.x=r.vrData.rightEyeX||.1,(r.isTouch||r.vrInput)&&(e.useQuaternion=!0),e.add(l,v),t.autoClear=!1,r.customShader&&(s=SQR.FrameBuffer(0,0),c=SQR.Primitives.createPostEffect(r.customShader),c.uniforms={scale:new SQR.V2(.81,.81),scaleIn:new SQR.V2(1,1),lensCenter:new SQR.V2(0,0),hmdWarpParam:[1,.11,.12,0],chromAbParam:[.996,-.004,1.014,0]}),{size:function(){var t=window.devicePixelRatio;o=window.innerWidth*t,i=window.innerHeight*t,a=o/2,n.size(window.innerWidth,window.innerHeight,t),r.customShader&&s.resize(a,i);var c=o/i,d=.5*o/i,m=u?80:50;r.vrData&&r.vrData.leftEyeFOV&&(m=2*r.vrData.leftEyeFOV.leftDegrees);var f=(new SQR.ProjectionMatrix).perspective(m,u?d:c,r.near||.1,r.far||1e4);e.projection=f,l.projection=f,v.projection=f},render:function(m){if(r.vrInput){var f=r.vrInput.getState();null!==f.orientation&&e.quaternion.copyFrom(f.orientation),null!==f.position&&e.position.copyFrom(f.position)}else r.isTouch&&SQR.Gyro.hasGyro()?e.quaternion.copyFrom(SQR.Gyro.getOrientation()):r.customCameraAnimation&&r.customCameraAnimation();if(n.viewport(0,0,o,i),n.clear(),u?r.customShader?(s.bind(),n.clear(),t.render(m,l),t.renderToScreen(),n.viewport(0,0,a,i),c.shader.use().setUniform("uTexture",s.texture),t.render(c),s.bind(),n.clear(),t.render(m,v),t.renderToScreen(),n.viewport(a,0,a,i),c.shader.use().setUniform("uTexture",s.texture),t.render(c)):(n.viewport(0,0,a,i),t.render(m,l),n.viewport(a,0,a,i),t.render(m,v)):t.render(m,e),d){if(r.target&&r.camRoot){var w=(new SQR.V3).sub(r.camRoot.position,r.target.position),y=(new SQR.V3).copyFrom(e.forward);w.y=0,y.y=0,w.norm(),y.norm();var h=SQR.V3.dot(w,y);Math.acos(h),Math.PI;r.camRoot.rotation.y=-Math.acos(h)}d=!1}}}};
>>>>>>> a7db36e19cbc9dad4b5f6af1c2da49af737fd041
